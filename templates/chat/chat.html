{% extends 'layout.html' %}
{% load static %}

{% block title %}Chat - Resonance{% endblock %}

{% block content %}
<body class="bg-[#0a0e27]">

    {{ request.user.id|json_script:"current-user-id" }}

    <div class="flex h-screen">
        <!-- Main Chat Area -->
        <div class="flex-1 flex">
            <!-- Chat List Panel (Now Dynamic) -->
            <div class="w-80 bg-[#050505] border-r border-white/5 flex flex-col">
                <!-- Search Bar -->
                <div class="p-4 border-b border-white/5">
                    <div class="relative">
                        <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                        <input type="text" placeholder="Search" class="w-full bg-[#1a1f3a] border border-white/10 rounded-lg py-2.5 pl-10 pr-4 text-white text-sm placeholder-gray-500 focus:outline-none focus:border-green-500 focus:ring-1 focus:ring-green-500 transition-colors">
                    </div>
                </div>

                <!-- Chat List (Generated by Django) -->
                <div id="chat-list-container" class="flex-1 overflow-y-auto px-3 py-3 space-y-2">
                    {% for chat in chat_list %}
                    <button 
                        class="w-full flex items-center gap-3 p-3 rounded-xl hover:bg-white/5 transition-colors chat-item" 
                        id="chat-btn-{{ chat.chat_id }}"
                        data-chat-id="{{ chat.chat_id }}"
                        data-chat-name="{{ chat.other_user.username }}"
                        data-chat-avatar="{{ chat.other_user.profile_picture.url|default:'/path/to/default/avatar.png' }}">
                        
                        <img src="{{ chat.other_user.profile_picture.url|default:'/path/to/default/avatar.png' }}" alt="{{ chat.other_user.username }}" class="w-12 h-12 rounded-full object-cover flex-shrink-0">
                        <div class="flex-1 min-w-0 text-left">
                            <div class="flex justify-between items-center">
                                <span class="font-semibold text-white text-sm">{{ chat.other_user.username }}</span>
                            </div>
                            <p class="text-xs text-gray-400 truncate">Start a conversation</p>
                        </div>
                    </button>
                    {% empty %}
                    <p class="text-center text-gray-500 p-4">No matches yet. Keep swiping!</p>
                    {% endfor %}
                </div>
            </div>

            <!-- Chat Window -->
            <main class="flex-1 flex flex-col bg-[#050505]">
                <!-- Empty State -->
                <div class="flex-1 flex flex-col items-center justify-center" id="emptyState">
                    <svg class="w-24 h-24 text-gray-600 mb-6" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <h2 class="text-3xl font-bold text-white mb-2">Select a chat</h2>
                    <p class="text-gray-500">Choose a match to start messaging</p>
                </div>

                <!-- Chat Window -->
                <div id="chatWindow" class="hidden flex flex-col h-full">
                    <!-- Chat Header -->
                    <header class="flex items-center justify-between p-6 border-b border-white/5 bg-[#0a0e27]">
                        <div class="flex items-center gap-4">
                            <img id="chatAvatar" src="" alt="User" class="w-14 h-14 rounded-full object-cover">
                            <div>
                                <h2 id="chatName" class="text-2xl font-bold text-white"></h2>
                            </div>
                        </div>
                    </header>

                    <!-- Messages -->
                    <div id="messagesContainer" class="flex-1 p-6 overflow-y-auto flex flex-col gap-4">                    </div>

                    <!-- Message Input -->
                    <footer class="p-6 border-t border-white/5 bg-[#0a0e27]">
                        <form class="flex items-center gap-4">
                            <input id="messageInput" class="flex-1 bg-[#1a1f3a] border border-white/10 rounded-xl py-3 px-5 text-white placeholder-gray-500 focus:outline-none focus:border-green-500 focus:ring-1 focus:ring-green-500 transition-colors" type="text" placeholder="Type a message..." autocomplete="off" />
                            <button type="submit" class="bg-green-600 hover:bg-green-500 text-white rounded-lg w-12 h-12 flex items-center justify-center transition-colors flex-shrink-0 font-semibold">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M16.6915026,12.4744748 L3.50612381,13.2599618 C3.19218622,13.2599618 3.03521743,13.4170592 3.03521743,13.5741566 L1.15159189,20.0151496 C0.8376543,20.8006365 0.99,21.89 1.77946707,22.52 C2.40337462,22.99 3.50612381,23.1 4.13003135,22.8429026 L21.714504,14.0454487 C22.6563168,13.5741566 23.1272231,12.6315722 22.9702544,11.6889879 L4.13003135,1.16346272 C3.34915502,0.9 2.40337462,0.779452545 1.77946707,1.24581726 C0.994580809,1.71218198 0.837611624,2.50572888 1.15159189,3.29108165 L3.03521743,9.73267464 C3.03521743,9.88976228 3.34915502,10.0468599 3.50612381,10.0468599 L16.6915026,10.8323469 C16.6915026,10.8323469 17.1624089,10.8323469 17.1624089,10.4395722 L17.1624089,12.3915722 C17.1624089,12.4744748 16.6915026,12.4744748 16.6915026,12.4744748 Z"></path>
                                </svg>
                            </button>
                        </form>
                    </footer>
                </div>
            </main>
        </div>
    </div>

     {{ request.user.id|json_script:"current-user-id" }}

    <script src="{% static 'js/chat.js' %}"></script>

</body>
{% endblock %}